import torch
from pathlib import Path
from PIL import Image

# Load YOLOv5
model = torch.hub.load('ultralytics/yolov5', 'custom', path="C:/Users/USER/PycharmProjects/pythonProject/Malware_Yolo/best.pt", force_reload =True)

# Set the model to evaluation mode
model.eval()

# Load and preprocess a test image
img_path = "C:/Users/USER/PycharmProjects/pythonProject/Malware_Yolo/train/images/A1.jpg"  # Replace 'path/to/your/test/image.jpg' with the actual path
img = Image.open(img_path)
img = model.preprocess(img)[0]

# Make predictions
with torch.no_grad():
    predictions = model(img.unsqueeze(0))  # Add an extra dimension for the batch

# Display predictions
results = model.postprocess(predictions)[0]
results.show()

# Save results to a file
results.save(Path("C:/Users/USER/PycharmProjects/pythonProject/Malware_Yolo"))
